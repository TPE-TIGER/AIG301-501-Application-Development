# Azure IoT Central Demo Application
Document Version: V1.0

##### Change Log

| Version | Date       | Content          |
| ------- | ---------- | ---------------- |
| 1.0     | 2022-02-10 | Document created |



### Purpose

This application demonstrates below features and possibility for your owned ThingsPro Edge Application:

- Web Admin GUI
- Web Restful API 
- Invoke ThingsPro Edge Restful API
- Connect to Azure IoT Central for
  - Telemetry Publish to Cloud
  - Device Management from Cloud



### 1. How to Run ...

- A Moxa IIoT Gateway running with ThingsPro Edge V2.2.0+

- Download application

  - Binary : https://tpe2.azureedge.net/aic_1.2-650_armhf.mpkg
  - Source : https://tpe2.azureedge.net/AzureIoTCentral.tar

- Install application on Moxa IIoT Gateway Linux console by below command：

  ```
  moxa@Moxa:~$ sudo appman app install aic_1.2-650_armhf.mpkg
  ```

- Verify installation completed and running well.

  ```
  moxa@Moxa:~$ sudo appman app ls
  +--------------+-------------+-----------------------+--------+
  |     NAME     |   VERSION   | STATE (DESIRED STATE) | HEALTH |
  +--------------+-------------+-----------------------+--------+
  | aic          | 1.2-650     | ready (ready)         | good   |
  | edge-web     | 1.9.17-5046 | ready (ready)         | good   |
  | tagservice   | 2.2.0-575   | ready (ready)         | good   |
  +--------------+-------------+-----------------------+--------+
  ```

- Open Browser connect to your IIoT Gateway Admin Web + demo application configuration page

  ```
  https://{IIoT Gateway IP}:8443/api/v1/aic
  ```

  <img src="https://thingspro.blob.core.windows.net/resource/document/aic/aic01.jpg" style="zoom:67%;" />

- On the Azure IoT Central, you have to...

  - Create an Azure IoT Central account

  - Create an IoT Device Template, and import <a href="https://github.com/KevinKao809/TPE-AzureIoTCentral/blob/main/tpe-app/src/data/deviceTemplateV0.5.json">DTDL file</a>, which required by this demo application.

  - Create an IoT Device, get it's connection meta data, and fill required data into demo application configuration form which show on above.

    

### 2. Functionality

This demo application contains 3 commands, 3 telemetries, and 5 properties, you also can find them on <a href="https://github.com/KevinKao809/TPE-AzureIoTCentral/blob/main/tpe-app/src/data/deviceTemplateV0.5.json">DTDL file</a>.

##### 2.1 Command

|      | command        | note                               |
| ---- | -------------- | ---------------------------------- |
| 1    | reboot         | To restart device                  |
| 2    | turnOnMonitor  | To turn on device monitor feature  |
| 3    | turnOffMonitor | To turn off device monitor feature |

##### 2.2 Telemetry

|      | name          | note                                                         |
| ---- | ------------- | ------------------------------------------------------------ |
| 1    | cpuLoad       | CPU loading data will send to Azure IoT Central after turn on Monitor |
| 2    | lan1NetworkTx | LAN 1 outbound traffic will send to Azure IoT Central after turn on Monitor |
| 3    | lan1NetworkRx | LAN 1 inbound traffic will send to Azure IoT Central after turn on Monitor |

##### 2.3 Property

|      | name                 | Note                                                         |
| ---- | -------------------- | ------------------------------------------------------------ |
| 1    | general_serialNumber | Read only, to display device serial number                   |
| 2    | general_deviceModel  | Read only, to display device model name                      |
| 3    | general_hostName     | Read/Write, to display and set device host name              |
| 4    | service_ssh          | Read/Write, to display and enable/disable ssh service of device |
| 5    | ethernet_lan2_ip     | Read/Write, to display and set LAN2 IP address               |

### 3. Azure IoT Central Device Authentication

This demo application supports below authentication type to Azure IoT Central

|      | Authentication type           | Note                                                 |
| ---- | ----------------------------- | ---------------------------------------------------- |
| 1    | Shared access signature (SAS) | Symmetric Key：From Azure IoT Central                |
| 2    | Certificates (X.509)          | X.509 Certificate：Generated by Root/Intermediate CA |



### 4. Azure IoT Central Known Issue

1. On Azure IoT Central, there is no way to update property for a individual device. Only allow to update property for one or many device group.

2. When apply properties update on IoT Central, IoT Central show all devices' status are completed, but it means the desired properties sent to Azure IoT Hub, rather than devices receive desired properties.

   <img src="https://thingspro.blob.core.windows.net/resource/document/aic/aic02.jpg" style="zoom: 50%;" />

   

3. Set ethernet_lan2_ip property will always fail on this demo application by design (due to incomplete payload), but this exception message doesn't display on Azure IoT Central, even demo app follows Azure Plug & Play (DTDL) conversation (refer to https://docs.microsoft.com/en-us/azure/iot-develop/concepts-convention)